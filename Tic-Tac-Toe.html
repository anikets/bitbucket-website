<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Tic Tac Toe</title>
    <meta charset="UTF-8">

    <!-- My version of the Tic Tac Toe -->

    <style type="text/css">
      body {
        font-family: Tahoma;
      }
      td {
        font-size: 70px;
        background: #ccc;
        text-align: center;
        width: 100px;
        height: 100px;
        line-height: 100px;
      }
      td:hover {
        background: #eee;
        cursor: pointer;
      }
      div {
        margin-top: 10px;
        font-size: 20px;
      }
    </style>
  </head>
  <body>
    <table>
      <tr>
        <td data-index='0'></td>
        <td data-index='1'></td>
        <td data-index='2'></td>
      </tr>
      <tr>
        <td data-index='3'></td>
        <td data-index='4'></td>
        <td data-index='5'></td>
      </tr>
      <tr>
        <td data-index='6'></td>
        <td data-index='7'></td>
        <td data-index='8'></td>
      </tr>
    </table>

    <div></div>

    <p></p>

    <script type="text/javascript">
      /*
        1. User clicks on a squre to start the game.
        2. Computer fills in next square.
        3. User plays next turn.
        4. If there are 3 consecutive Xs or Os, there's a win. Game ends
        5. 2 & 3 repeated until all squares are filled, or game ends.
        6. Game draws if no one wins and game ends.
        */

      /* To-dos:
        * User shouldn't be able to click on computer's square.
        * Build intelligence in computer's moves. */

      /* Shorten variable names. */
      var d = document;
      d.byTag = d.getElementsByTagName;

      var board = d.byTag('td');
      var emptySpaces = [];
      var msgSuccess = "You win! You are awesome. \\m/";
      var msgFail = "Computer wins. :( Better luck next time.";
      var state = {
        0: 0,
        1: 0,
        2: 0,
        3: 0,
        4: 0,
        5: 0,
        6: 0,
        7: 0,
        8: 0
      };

      (function init() {
        for ( counter = 0; counter < board.length; counter++ ) {
          board[counter].addEventListener('click', function() {
            //console.log( 'click' );
            if ( this.innerHTML != 'O' ) {
              this.innerHTML = 'X';
              state[parseInt(this.getAttribute( 'data-index' ))] = 1;
              computersTurn();
            }
          }, false);
        }
      })();

      function computersTurn() {
        checkVictory();
        emptySpaces = [];
        for ( var key in state ) {
          if ( state[key] == 0 )
            emptySpaces.push();
        }
        var int = setInterval( function() {
          var found = parseInt(Math.random() * 8 - 1);
          if ( state[found] == 0 ) {
            board[found].innerHTML = 'O';
            state[found]
            clearInterval( int );
          }
        }, 10);
        checkVictory();
      }

      function checkVictory() {
        if ( state[0] == 1 && state[1] == 1 && state[2] == 1 ) { d.byTag( 'div' )[0].innerHTML = msgSuccess; showGameOverMsg(); }
        if ( state[3] == 1 && state[4] == 1 && state[5] == 1 ) { d.byTag( 'div' )[0].innerHTML = msgSuccess; showGameOverMsg(); }
        if ( state[6] == 1 && state[7] == 1 && state[8] == 1 ) { d.byTag( 'div' )[0].innerHTML = msgSuccess; showGameOverMsg(); }

        if ( state[0] == 1 && state[3] == 1 && state[6] == 1 ) { d.byTag( 'div' )[0].innerHTML = msgSuccess; showGameOverMsg(); }
        if ( state[1] == 1 && state[4] == 1 && state[7] == 1 ) { d.byTag( 'div' )[0].innerHTML = msgSuccess; showGameOverMsg(); }
        if ( state[2] == 1 && state[5] == 1 && state[8] == 1 ) { d.byTag( 'div' )[0].innerHTML = msgSuccess; showGameOverMsg(); }

        if ( state[0] == 1 && state[4] == 1 && state[8] == 1 ) { d.byTag( 'div' )[0].innerHTML = msgSuccess; showGameOverMsg(); }
        if ( state[6] == 1 && state[4] == 1 && state[2] == 1 ) { d.byTag( 'div' )[0].innerHTML = msgSuccess; showGameOverMsg(); }


        if ( state[0] == 2 && state[1] == 2 && state[2] == 2 ) { d.byTag( 'div' )[0].innerHTML = msgFail; showGameOverMsg(); }
        if ( state[3] == 2 && state[4] == 2 && state[5] == 2 ) { d.byTag( 'div' )[0].innerHTML = msgFail; showGameOverMsg(); }
        if ( state[6] == 2 && state[7] == 2 && state[8] == 2 ) { d.byTag( 'div' )[0].innerHTML = msgFail; showGameOverMsg(); }

        if ( state[0] == 2 && state[3] == 2 && state[6] == 2 ) { d.byTag( 'div' )[0].innerHTML = msgFail; showGameOverMsg(); }
        if ( state[1] == 2 && state[4] == 2 && state[7] == 2 ) { d.byTag( 'div' )[0].innerHTML = msgFail; showGameOverMsg(); }
        if ( state[2] == 2 && state[5] == 2 && state[8] == 2 ) { d.byTag( 'div' )[0].innerHTML = msgFail; showGameOverMsg(); }

        if ( state[0] == 2 && state[4] == 2 && state[8] == 2 ) { d.byTag( 'div' )[0].innerHTML = msgFail; showGameOverMsg(); }
        if ( state[6] == 2 && state[4] == 2 && state[2] == 2 ) { d.byTag( 'div' )[0].innerHTML = msgFail; showGameOverMsg(); }
      }

      function showGameOverMsg() {
        d.byTag( 'p' )[0].innerHTML = 'Refresh page to start a new game';
        d.byTag( 'table' )[0].style.opacity = 0.2;
        // Remove event listeners.
      }
    </script>
  </body>
</html>
